@using Shared
@{
    ViewBag.Title = "Home Page";
}



<div class="row">
    @{

        if (HttpContext.Current.User.IsInRole(ConstsAccesEngin.ROLE_CHEFPROJET))
        {
            <div class="col-md-6">
                <div id="chartContainer" style="height: 370px; width: 100%;"></div>
            </div>
        }
        if (HttpContext.Current.User.IsInRole(ConstsAccesEngin.ROLE_CHEFPROJET) || HttpContext.Current.User.IsInRole(ConstsAccesEngin.ROLE_CONTROLEUR))
        {
            <div class="col-md-6">
                <div id="chartContainer1" style="height: 370px; width: 100%;"></div>
            </div>
        }
        <div class="col-md-6">
            <div id="chartExpireId" style="height: 370px; width: 100%;"></div>
        </div>

    }
</div>



@section scripts{

    <script src="~/Scripts/canvasjs.min.js"></script>
    @if (HttpContext.Current.User.IsInRole(ConstsAccesEngin.ROLE_CHEFPROJET))
    {
        <script type="text/javascript">
            window.onload = function () {
                var posting = $.post('/AccesEnginapi/FillChartPieMyDemande', function (response) {
                    CanvasJS.addColorSet("greenShades",
                        [//colorSet Array
                            "#81C5D7",
                            "#F9B67F",
                        ]);
                    var chart = new CanvasJS.Chart("chartContainer", {
                        animationEnabled: true,
                        colorSet: "greenShades",
                        title: {
                            text: "Mes Demandes contrôlées / non contrôlées"
                        },
                        data: [{
                            type: "pie",
                            startAngle: 240,
                            yValueFormatString: "##0.00\"%\"",
                            indexLabel: "{label} {y}",
                            dataPoints: [
                                { y: response.data.CountController, label: "Demandes contrôlées" },
                                { y: response.data.CountNonController, label: "Demandes non contrôlées" },

                            ]
                        }]
                    });
                    chart.render();
                });
                var posting = $.post('/AccesEnginapi/FillChartPieMyDemandeAutorise', function (response) {
                    var chart = new CanvasJS.Chart("chartContainer1", {
                        animationEnabled: true,
                        title: {
                            text: "Demandes autorisées / non autorisées"
                        },
                        data: [{
                            type: "pie",
                            startAngle: 240,
                            yValueFormatString: "##0.00\"%\"",
                            indexLabel: "{label} {y}",
                            dataPoints: [
                                { y: response.data.CountController, label: "Demandes autorisées" },
                                { y: response.data.CountNonController, label: "Demandes non autorisées" },

                            ]
                        }]
                    });
                    chart.render();
                });
            FileChartExpire()
            }
        </script>
    }
    @if (HttpContext.Current.User.IsInRole(ConstsAccesEngin.ROLE_CONTROLEUR))
    {
        <script type="text/javascript">
            window.onload = function () {
                var posting = $.post('/AccesEnginapi/FillChartPieMyDemandeAutorise', function (response) {
                    var chart = new CanvasJS.Chart("chartContainer1", {
                        animationEnabled: true,
                        title: {
                            text: "Mes Demandes autorisé / non autorisé"
                        },
                        data: [{
                            type: "pie",
                            startAngle: 240,
                            yValueFormatString: "##0.00\"%\"",
                            indexLabel: "{label} {y}",
                            dataPoints: [
                                { y: response.data.CountController, label: "Demande autorisé" },
                                { y: response.data.CountNonController, label: "Demande non autorisé" },

                            ]
                        }]
                    });
                    chart.render();
                });
                FileChartExpire()
            }
        </script>
    }

    <script type="text/javascript">
    function FileChartExpire() {
        var posting = $.post('/AccesEnginapi/MesDemandeExpire', function (response) {
            CanvasJS.addColorSet("greenShades",
                [//colorSet Array
                    "#DF7970",
                    "#51CDA0",
                ]);

                var chart = new CanvasJS.Chart("chartExpireId", {
                    animationEnabled: true,
                    colorSet: "greenShades",
                    title: {
                        text: "Les Demandes expiré / non expiré"
                    },
                    data: [{
                        type: "pie",
                        startAngle: 240,
                        yValueFormatString: "##0.00\"%\"",
                        indexLabel: "{label} {y}",
                        dataPoints: [
                            { y: response.data.CountController, label: "Demande expiré" },
                            { y: response.data.CountNonController, label: "Demande non expiré" },

                        ]
                    }]
                });
                chart.render();
            });
        }
    </script>

}



